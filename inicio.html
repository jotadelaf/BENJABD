<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Empleados</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Sistema de Empleados</h1>
        
        <!-- Navegación -->
        <nav class="nav-tabs">
            <button class="nav-btn active" onclick="showForm('registrar')">Registrar</button>
            <button class="nav-btn" onclick="showForm('modificar')">Modificar</button>
            <button class="nav-btn" onclick="showForm('eliminar')">Eliminar</button>
            <button class="nav-btn" onclick="showForm('listar1')">Listar 1</button>
            <button class="nav-btn" onclick="showForm('listar2')">Listar 2</button>
            <button class="nav-btn" onclick="window.location.href='ver_respaldos.php'">Respaldos</button>
        </nav>

        <!-- Formulario Registrar Empleado -->
        <div id="registrar" class="form-section active">
            <h2>Registrar Empleado</h2>
            <form action="insertar.php" method="post">
                <div class="form-group">
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>

                <div class="form-group">
                    <label for="apellido">Apellido:</label>
                    <input type="text" id="apellido" name="apellido" required>
                </div>

                <div class="form-group">
                    <label for="sexo">Sexo:</label>
                    <select id="sexo" name="sexo" required>
                        <option value="">Seleccione</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Femenino">Femenino</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="sueldo">Sueldo:</label>
                    <input type="number" id="sueldo" name="sueldo" step="0.01" min="0" required>
                </div>

                <button type="submit" class="btn-submit">Registrar Empleado</button>
            </form>
        </div>

        <!-- Formulario Modificar Empleado -->
        <div id="modificar" class="form-section">
            <h2>Modificar Sueldo de Empleado</h2>
            <form action="actualizar.php" method="post">
                <div class="form-group">
                    <label for="buscar_empleado">Buscar Empleado:</label>
                    <div class="search-container">
                        <input type="text" id="buscar_empleado" name="buscar_empleado" placeholder="Escriba el nombre del empleado..." autocomplete="off">
                        <div id="search-results" class="search-results" style="display: none;"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="empleado_seleccionado">Empleado Seleccionado:</label>
                    <input type="text" id="empleado_seleccionado" name="empleado_seleccionado" readonly>
                    <input type="hidden" id="empleado_id" name="empleado_id">
                </div>

                <div class="form-group">
                    <label for="nuevo_sueldo">Nuevo Sueldo:</label>
                    <input type="number" id="nuevo_sueldo" name="nuevo_sueldo" step="0.01" min="0" required>
                </div>

                <button type="submit" class="btn-submit">Actualizar Sueldo</button>
            </form>
        </div>

        <!-- Formulario Eliminar Empleado -->
        <div id="eliminar" class="form-section">
            <h2>Eliminar Empleado</h2>
            <form action="eliminar.php" method="post">
                <div class="form-group">
                    <label for="campo_eliminar">Campo de Condición:</label>
                    <select id="campo_eliminar" name="campo_eliminar" required>
                        <option value="">Seleccione campo</option>
                        <option value="nombre">Nombre</option>
                        <option value="apellido">Apellido</option>
                        <option value="sexo">Sexo</option>
                        <option value="sueldo">Sueldo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="valor_eliminar">Valor de Condición:</label>
                    <input type="text" id="valor_eliminar" name="valor_eliminar" required>
                </div>

                <button type="submit" class="btn-submit btn-danger">Eliminar Empleado</button>
            </form>
        </div>

        <!-- Formulario Listar Empleados 1 -->
        <div id="listar1" class="form-section">
            <h2>Listar Empleados (Método 1)</h2>
            <form action="listar1.php" method="post">
                <button type="submit" class="btn-submit">Mostrar Todos los Empleados</button>
            </form>
        </div>

        <!-- Formulario Listar Empleados 2 -->
        <div id="listar2" class="form-section">
            <h2>Listar Empleados (Método 2)</h2>
            <form action="listar2.php" method="post">
                <div class="form-group">
                    <label for="filtro_sexo">Filtrar por Sexo:</label>
                    <select id="filtro_sexo" name="filtro_sexo">
                        <option value="">Todos</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Femenino">Femenino</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>

                <button type="submit" class="btn-submit">Mostrar Empleados Filtrados</button>
            </form>
        </div>
    </div>

    <script>
        function showForm(formId) {
            // Ocultar todos los formularios
            const forms = document.querySelectorAll('.form-section');
            forms.forEach(form => form.classList.remove('active'));
            
            // Mostrar el formulario seleccionado
            document.getElementById(formId).classList.add('active');
            
            // Actualizar botones de navegación
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Funcionalidad de búsqueda en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('buscar_empleado');
            const searchResults = document.getElementById('search-results');
            const empleadoSeleccionado = document.getElementById('empleado_seleccionado');
            const empleadoId = document.getElementById('empleado_id');
            let searchTimeout;

            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const query = this.value.trim();
                    
                    // Limpiar timeout anterior
                    clearTimeout(searchTimeout);
                    
                    // Ocultar resultados si no hay consulta
                    if (query.length < 2) {
                        searchResults.style.display = 'none';
                        return;
                    }

                    // Buscar después de 300ms de inactividad
                    searchTimeout = setTimeout(() => {
                        buscarEmpleados(query);
                    }, 300);
                });

                // Ocultar resultados al hacer clic fuera
                document.addEventListener('click', function(e) {
                    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                        searchResults.style.display = 'none';
                    }
                });
            }

            function buscarEmpleados(query) {
                // Crear formulario temporal para enviar datos
                const formData = new FormData();
                formData.append('action', 'buscar');
                formData.append('query', query);

                fetch('actualizar.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    mostrarResultados(data);
                })
                .catch(error => {
                    console.error('Error en la búsqueda:', error);
                });
            }

            function mostrarResultados(empleados) {
                searchResults.innerHTML = '';
                
                if (empleados.length === 0) {
                    searchResults.innerHTML = '<div class="search-result-item">No se encontraron empleados</div>';
                } else {
                    empleados.forEach(empleado => {
                        const item = document.createElement('div');
                        item.className = 'search-result-item';
                        item.innerHTML = `
                            <div class="employee-name">${empleado.nombre} ${empleado.apellido}</div>
                            <div class="employee-details">Sueldo actual: $${empleado.sueldo} | Sexo: ${empleado.sexo}</div>
                        `;
                        
                        item.addEventListener('click', function() {
                            empleadoSeleccionado.value = `${empleado.nombre} ${empleado.apellido}`;
                            empleadoId.value = empleado.id;
                            searchInput.value = `${empleado.nombre} ${empleado.apellido}`;
                            searchResults.style.display = 'none';
                        });
                        
                        searchResults.appendChild(item);
                    });
                }
                
                searchResults.style.display = 'block';
            }
        });
    </script>
</body>
</html>
